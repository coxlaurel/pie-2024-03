<!DOCTYPE html>
<html style="font-size: 16px;" lang="en"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="​Electrician Services, ​Satisfaction Guaranteed, Our Services, Testimonials, ​Feel Free To Ask Me Anything">
    <meta name="description" content="">
    <title>Firmware</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Firmware.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 7.1.0, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,400,400i,700,700i,900,900i|Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Source+Code+Pro:200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Arizonia:400">
    
    
    
    
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Firmware">
    <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/"></head>
  <body data-path-to-root="./" data-include-products="false" class="u-body u-xl-mode" data-lang="en"><header class="u-clearfix u-header u-header" id="sec-4e5f"><div class="u-clearfix u-sheet u-sheet-1">
        <img class="u-image u-image-contain u-image-default u-image-1" src="images/image1.png" alt="" data-image-width="558" data-image-height="418" data-href="./">
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
            <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-top-bottom-menu-spacing u-hamburger-link u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg class="u-svg-link" viewBox="0 0 24 24"><use xlink:href="#menu-hamburger"></use></svg>
              <svg class="u-svg-content" version="1.1" id="menu-hamburger" viewBox="0 0 16 16" x="0px" y="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</g></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="./" style="padding: 10px 20px;">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" style="padding: 10px 20px;">Sprints!</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10"><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Sprint-1.html">Sprint 1</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Sprint2.html">Sprint 2</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Sprint-3.html">Sprint 3</a>
</li></ul>
</div>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" style="padding: 10px 20px;">Systems</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10"><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Mechanical.html">Mechanical</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Electrical.html">Electrical</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Software.html">Software</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="Firmware.html">Firmware</a>
</li></ul>
</div>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="Bill-of-Materials.html" style="padding: 10px 20px;">Bill of Materials</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="About-Us.html" style="padding: 10px 20px;">About Us</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-4"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="./">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link">Sprints!</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Sprint-1.html">Sprint 1</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Sprint2.html">Sprint 2</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Sprint-3.html">Sprint 3</a>
</li></ul>
</div>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link">Systems</a><div class="u-nav-popup"><ul class="u-h-spacing-20 u-nav u-unstyled u-v-spacing-10"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Mechanical.html">Mechanical</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Electrical.html">Electrical</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Software.html">Software</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Firmware.html">Firmware</a>
</li></ul>
</div>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Bill-of-Materials.html">Bill of Materials</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="About-Us.html">About Us</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
        <p class="u-custom-font u-text u-text-default u-text-1">Cyberflex</p>
      </div></header>
    <section class="u-clearfix u-image u-shading u-section-1" id="sec-0876" data-image-width="736" data-image-height="552">
      <div class="u-clearfix u-sheet u-valign-middle-lg u-valign-middle-md u-valign-middle-sm u-valign-middle-xl u-sheet-1">
        <h1 class="u-text u-text-1" data-animation-name="customAnimationIn" data-animation-duration="2000">Firmware</h1>
        <p class="u-text u-text-2">Our software team was very intentional in achieving their learning goals of understanding motor movement&nbsp;</p>
      </div>
    </section>
    <section class="u-clearfix u-section-2" id="sec-6ab8">
      <div class="u-clearfix u-sheet u-sheet-1">
        <div class="data-layout-selected u-clearfix u-expanded-width u-layout-wrap u-layout-wrap-1">
          <div class="u-layout" style="">
            <div class="u-layout-row" style="">
              <div class="u-align-center u-container-align-center u-container-style u-layout-cell u-size-30 u-layout-cell-1">
                <div class="u-container-layout u-valign-middle u-container-layout-1">
                  <h2 class="u-custom-font u-font-merriweather u-text u-text-default u-text-1" data-animation-name="customAnimationIn" data-animation-duration="2000">What We Accomplished!</h2>
                </div>
              </div>
              <div class="u-container-style u-layout-cell u-size-30 u-layout-cell-2">
                <div class="u-container-layout u-container-layout-2">
                  <ul class="u-custom-list u-spacing-10 u-text u-text-default u-text-2">
                    <li style="padding-left: 20px;">
                      <div class="u-list-icon u-text-palette-1-light-1">
                        <div style="font-size: 1.2em; margin: -1.2em;">►</div>
                      </div>
                    </li>
                    <li style="padding-left: 20px;">Connected multiple DC motors to the robotic hand controlled by Arduino Motor Shields</li>
                    <li style="padding-left: 20px;">
                      <div class="u-list-icon u-text-palette-1-light-1">
                        <div style="font-size: 1.2em; margin: -1.2em;">►</div>
                      </div>
                    </li>
                    <li style="padding-left: 20px;">
                      <div class="u-list-icon u-text-palette-1-light-1">
                        <div style="font-size: 1.2em; margin: -1.2em;">►</div>
                      </div>Using Raspberry Pi for live predictions
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="u-clearfix u-section-3" id="sec-7f76">
      <div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-align-left u-text u-text-default u-text-1">
          <span style="font-weight: 700;">The main firmware for this project is Arduino Code written to:<br>
          </span>
          <br>1) Read sEMG sensor data <br>2) Transfer it to our python script which is doing the live detection of signals (see software page) and have that python script predict what the gesture is <br>3) Receive the gesture prediction from the python script and move motors connected to motor shields <br>
          <br>Starting off, we must first initialize our motors shields, which in this case, we have three of. Each of them have a unique I2C address which we must also account for in our initialization. To map to the proper address, we must solder the pads above the power pins in the image below. 0x60 corresponds to no pads soldered, 0x61 to the first pad soldered, and 0x62 to the second pad soldered. We can then simply stack the motorshields on top of each other.&nbsp;&nbsp;<br>
        </p>
        <img class="u-image u-image-contain u-image-default u-image-1" src="images/image31.png" alt="" data-image-width="801" data-image-height="609">
        <p class="u-align-left u-custom-font u-text u-text-default u-text-2"> The initialization can be done in code like this: <br>
          <span class="u-text-palette-1-base">
            <br>
            <span class="u-text-palette-2-base">Adafruit_MotorShield AFMS1 = Adafruit_MotorShield(0x60); <br>Adafruit_MotorShield AFMS2 = Adafruit_MotorShield(0x61); <br>Adafruit_MotorShield AFMS3 = Adafruit_MotorShield(0x62); 
            </span>
          </span>
          <br>
          <br>As seen above each motorshield also has 4 locations to place DC motors (M1, M2, M3, and M4). For our purposes, we connected motorshield 1 to the index, middle, ring, and pinky finger. We connected motorshield 2 to both thumb motors (to account for the thumb having to move in farther, the mechanical team decided to implement 2 motors). So far, these have both taken 6 volts which we can connect straight to the motorshield using the connection seen on the bottom left of the image. The last motorshield contains our two wrist motors which are both powered by 9 volts. These motors move together to move the wrist up and down. Putting this all together, we initialized our code like this: <br>
          <span class="u-text-palette-2-base">
            <br>// Index, Middle, Ring, and Pinky Fingers on first Shield <br>Adafruit_DCMotor *indexMotor = AFMS1.getMotor(1); <br>Adafruit_DCMotor *middleMotor = AFMS1.getMotor(2); <br>Adafruit_DCMotor *ringMotor = AFMS1.getMotor(3); <br>Adafruit_DCMotor *pinkyMotor = AFMS1.getMotor(4); <br>
            <br>// Inner and Outer Thumb Motors <br>Adafruit_DCMotor *thumbMotor1 = AFMS2.getMotor(1); <br>Adafruit_DCMotor *thumbMotor2 = AFMS2.getMotor(2); <br>
            <br>// Wrist motors <br>Adafruit_DCMotor *WristMotorLeft = AFMS3.getMotor(1); <br>Adafruit_DCMotor *WristMotorRight = AFMS3.getMotor(2);&nbsp;
          </span>
          <br>
          <br>We can then set the speed of our motors, which in our case we found a good balance to be 200, however this value can reach up to 255. <br>
          <span class="u-text-palette-2-base">
            <br>// Set motor speed <br>const int MOTOR_SPEED = 200; <br>
          </span>
          <br>We then want to define how exactly our fingers are opening and closing, which can be done like this: <br>
          <span class="u-text-palette-2-base">
            <br>// Define the open and close direction of the fingers <br>#define OPEN_DIR FORWARD <br>#define CLOSE_DIR BACKWARD <br>
          </span>
          <br>To collect data, we set a sample rate of 100hz (In most situations this could go up to around 1000hz, however, for our purposes we found 100hz to be more than adequate). We also want to set up millis to make sure our data is being collecting at the proper time stamps. <br>
          <span class="u-text-palette-2-base">
            <br>unsigned long sampleRate = 100; <br>unsigned long previousMillis = 0; <br>
          </span>
          <br>Lastly, to prevent too many gestures from happening at once, we store the last gesture to prevent it from being done twice in a row, and initialize a boolean value checking if a gesture is in progress to ensure two gestures can’t happen at the same time. <br>
          <span class="u-text-palette-2-base">
            <br>// Store previous gesture to prevent it from being done twice in a row <br>String lastGesture = ""; 
          </span>
          <br>
          <span class="u-text-palette-2-base">
            <br>// Make sure you can't take an input while a gesture is in progress <br>bool gestureInProgress = false; <br>
            <br>
          </span>Finally we can setup the code, establishing our baudrate (how fast the arduino communicates), setting our motors to stop to prevent the hand from moving when we don’t want it to, and beginning all the motorshields. <br>
          <span class="u-text-palette-2-base">
            <br>void setup() { <br> Serial.begin(115200); <br> AFMS1.begin(); <br> AFMS2.begin(); <br> AFMS3.begin(); <br> stopAllMotors(); <br>} <br>
            <br>
          </span>Next we want to set the loop which reads the sensor data. Ideally we would connect 5 sensors to our board, however we ran into a hardware issue that inexplicably left us only able to use 4 sensors. This again uses millis to ensure we stay in time. We can simply set the emg values to the analog pins on the arduino where our sensors are connected. We then print these values out for the live prediction python script to read out. <br>
          <span class="u-text-palette-2-base">
            <br>void loop() { <br> // Set up millis for accurate time reading <br> unsigned long currentMillis = millis(); <br>
            <br> if (currentMillis - previousMillis &gt;= (1000 / sampleRate)) { <br> previousMillis = currentMillis; <br>
            <br> // Read EMG values <br> // Note: Originally used 5 emg values but for some undetermined reason, attaching <br> // more than 4 prevented all of our code from working, so we switched back to <br> // using only 4 sensors <br>
            <br> int emgValue1 = analogRead(A0); <br> int emgValue2 = analogRead(A1); <br> int emgValue3 = analogRead(A2); <br> int emgValue4 = analogRead(A3); <br> // int emgValue5 = analogRead(A4); <br>
            <br> Serial.print(emgValue1); Serial.print(","); <br> Serial.print(emgValue2); Serial.print(","); <br> Serial.print(emgValue3); Serial.print(","); <br> Serial.println(emgValue4); // Serial.print(","); <br> // Serial.println(emgValue5); <br> } <br>
            <br>
            <span class="u-text-black">In this same loop we can then tell the code to only run if a gesture is not in progress (see code above) AND serial data is coming through, we can then perform the gesture predicted, which can be done with this code below: </span>
            <br>
            <br>if (!gestureInProgress &amp;&amp; Serial.available() &gt; 0) { <br> String input = Serial.readStringUntil('\n'); <br> input.trim(); <br>
            <br> Serial.print(input); <br>
            <br> // Perform gesture based on what the python script says <br> if (input.length() &gt; 0 &amp;&amp; input != lastGesture) { <br> performGesture(input); <br> lastGesture = input; <br>
            <br>
            <span class="u-text-black">Next we can simply map the gesture we get from the python script to a set of functions to move motors in our arduino script. For example, if we get an output of “Rock” from our live prediction file, it performs the function showRock(). <br>
              <br>We can call the function like this: 
            </span>
            <br>
            <br>void performGesture(String gestureName) { <br> if (gestureName == "Rock") { <br> showRock(); <br>
          </span>
          <br>We can then add several other ‘else if’ statements to account for other gestures which can be seen in the Github repository. <br>
          <br>The functions for each gesture themselves are all structured very similarly. In the case of showRock(), we first set gestureInProgress as true to prevent another gesture from occuring at the same time. We then set the desired motor states for the gesture (which in this case is very simple as we want them to all be closed), we set a delay to allow the motors to move and stop them afterwards. We set another delay to hold the gesture, and then reset all the motors by doing the inverse of what we did to move the motors, again stopping them afterwards. Lastly we set gestureInProgress as false to allow the script to perform another gesture. We do this for all the gestures defined in our code. This can all be seen in the code below:&nbsp;&nbsp;<br>
          <span class="u-text-palette-2-base">
            <br>void showRock() { <br> // Set a gesture to be in progress so that we don't perform multiple at a time <br> gestureInProgress = true; <br> // Set which motors to move <br> setMotorState(thumbMotor1, true); <br> setMotorState(thumbMotor2, true); <br> setMotorState(indexMotor, true); <br> setMotorState(middleMotor, true); <br> setMotorState(ringMotor, true); <br> setMotorState(pinkyMotor, true); <br> // Wait a second for all the motors to move to positions <br> delay(1000); stopAllMotors(); <br> // Hold the gesture for 1 second <br> delay(1000); <br> // Reset all the motors back to their original position <br> setMotorState(thumbMotor1, false); <br> setMotorState(thumbMotor2, false); <br> setMotorState(indexMotor, false); <br> setMotorState(middleMotor, false); <br> setMotorState(ringMotor, false); <br> setMotorState(pinkyMotor, false); <br> // Wait a second for all the motors to move back <br> delay(1000); stopAllMotors(); <br> // Set gesture in progress as false <br> gestureInProgress = false; <br>} <br>
          </span>
          <br>Lastly, before defining our gesture functions, we want to define what true and false mean in terms of motor movement, which can be done with this code: <br>
          <span class="u-text-palette-2-base">
            <br>void setMotorState(Adafruit_DCMotor *motor, bool open) { <br> if (open) { <br> motor-&gt;setSpeed(MOTOR_SPEED); <br> motor-&gt;run(OPEN_DIR); <br> } else { <br> motor-&gt;setSpeed(MOTOR_SPEED); <br> motor-&gt;run(CLOSE_DIR); <br> } <br>} 
          </span>
          <br>
          <br>We also want to define the stopAllMotors() function we use in our code to prevent the motors from overturning and breaking the mechanical system here: <br>
          <span class="u-text-palette-2-base">
            <br>void stopAllMotors() { <br> indexMotor-&gt;setSpeed(0); <br> indexMotor-&gt;run(RELEASE); <br>
            <br> middleMotor-&gt;setSpeed(0); <br> middleMotor-&gt;run(RELEASE); <br>
            <br> ringMotor-&gt;setSpeed(0); <br> ringMotor-&gt;run(RELEASE); <br>
            <br> pinkyMotor-&gt;setSpeed(0); <br> pinkyMotor-&gt;run(RELEASE); <br>
            <br> thumbMotor1-&gt;setSpeed(0); <br> thumbMotor1-&gt;run(RELEASE); <br>
            <br> thumbMotor2-&gt;setSpeed(0); <br> thumbMotor2-&gt;run(RELEASE); <br>} 
          </span>
          <br>
          <br>Although this code works effectively and doesn’t have flaws in execution, unfortunately, through our testing we found that DC motors were not at all the right tool to use as motors in this hand. Even though we power them forwards and backwards for the same amount of time, they still don't end up exactly where they started, giving us the issue that when we go do a new gesture the pulleys aren’t reacting the way we want them to. No matter how many times we reset the strings to be perfectly taught, ready to be pulled by the motor, by the time the first gesture was over, it was completely undone. Initially the code was implemented with servo motors, however due to an unfortunate miscommunication between electrical and mechanical subteams, we had to make due with DC motors for our final product, which as seen in our demo unfortunately leads to a not very consistent hand as seen from our demo. In the future, we would want to continue to use servo motors as opposed to DC motors due to the precision of servo motors, and much more ease of use (we were able to plug them directly into our Arduino unlike DC motors which we had to run through a shield). If we continue this project, this change should be the only factor holding us back from a fully functional prototype.&nbsp;&nbsp;<br>
        </p>
      </div>
    </section>
    <section class="u-clearfix u-section-4" id="sec-f4bf">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h1 class="u-align-center u-custom-font u-font-courier-new u-text u-text-1">You can view our code here on our public GitHub Repository!</h1>
      </div>
    </section>
    <section class="u-clearfix u-section-5" id="sec-9d24">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <a href="https://github.com/mfox0914/PIE_Final_Project_CyberFlex" class="u-align-center u-border-0 u-btn u-btn-round u-button-style u-custom-font u-font-merriweather u-hover-feature u-hover-palette-1-light-1 u-palette-1-base u-radius u-btn-1">Source Code </a>
      </div>
      
    </section>
    
    
    
    <footer class="u-align-center u-clearfix u-container-align-center u-footer u-grey-80 u-footer" id="sec-ab67"><div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <p class="u-custom-font u-font-montserrat u-small-text u-text u-text-variant u-text-1">ABOUT THIS SITE:&nbsp;<br>A Principles of Integrated Engineering Final Project by Esther Aduamah, Maya Adelman, Michaela Fox, Darian Jimenez, and Suwanee Li!
        </p>
      </div></footer>
    <section class="u-backlink u-clearfix u-grey-80">
      <p class="u-text">
        <span>This site was created with the </span>
        <a class="u-link" href="https://nicepage.com/" target="_blank" rel="nofollow">
          <span>Nicepage</span>
        </a>
      </p>
    </section>
  
</body></html>